{% load static %}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
			crossorigin="anonymous"
		/>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
		/>
		<title>FLEX</title>
		<link rel="stylesheet" href="{% static 'css/style.min.css' %}" />
		<style>
			@media screen and (max-width: 600px) {
				.profile-icon {
					display: none !important;
				}
			}
			#selected-contributors-container {
				display: flex;
				flex-wrap: wrap;
				gap: 5px;
			}
			.selected-contributor,
			.selected-technology {
				background-color: rgba(241, 196, 15, 0.1);
				border-color: 1px solid #f39c12;
				color: white;
				padding: 5px 10px;
				border-radius: 15px;
				gap: 5px;
				display: flex;
				align-items: center;
				width: fit-content;
			}

			.remove-contributor,
			.remove-technology {
				background: none;
				border: none;
				color: red;
				font-weight: bold;
				cursor: pointer;
				font-size: 14px;
			}
			
			.add-new-tech {
				border-top: 1px solid rgba(243, 156, 18, 0.3) !important;
				background-color: rgba(241, 196, 15, 0.05) !important;
				transition: all 0.2s ease;
			}
			
			.add-new-tech:hover {
				background-color: rgba(241, 196, 15, 0.15) !important;
				color: #f1c40f !important;
			}
			
			.add-new-tech i {
				margin-right: 5px;
				color: #f39c12;
			}
			
			/* Enhanced dropdown list styling */
			.dropdown-list {
				display: none;
				position: absolute;
				top: 100%;
				left: 0;
				right: 0;
				max-height: 200px;
				overflow-y: auto;
				border: 1px solid #ced4da;
				border-radius: 0.375rem;
				background-color: rgba(255, 255, 255, 0.95);
				z-index: 1050;
				margin-top: 2px;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}
			
			.dropdown-item {
				padding: 0.5rem 1rem;
				cursor: pointer;
				transition: background-color 0.2s ease;
				border-bottom: 1px solid rgba(0, 0, 0, 0.1);
			}
			
			.dropdown-item:hover {
				background-color: rgba(255, 215, 0, 0.1);
			}
			
			.dropdown-item:last-child {
				border-bottom: none;
			}
		</style>
	</head>

	<body>
		<div class="blur">
			<form action="" method="POST" id="project-form"></form>
		</div>

		<header>
			<img src="{% static 'img/logo.png' %}" alt="Profile Image" />
			<div class="title">
				<h1>MITS - FLEX</h1>
			</div>
		</header>

		<main>
			<div class="profile">
				<div class="profile-info">
					<a href="{% url 'profile' %}" class="profile-icon">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							fill="currentColor"
							class="bi bi-person-vcard-fill"
							viewBox="0 0 16 16"
							aria-hidden="true"
						>
							<path
								d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm9 1.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 0-.5.5M9 8a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 0-1h-4A.5.5 0 0 0 9 8m1 2.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 0-1h-3a.5.5 0 0 0-.5.5m-1 2C9 10.567 7.21 9 5 9c-2.086 0-3.8 1.398-3.984 3.181A1 1 0 0 0 2 13h6.96q.04-.245.04-.5M7 6a2 2 0 1 0-4 0 2 2 0 0 0 4 0"
							/>
						</svg>
					</a>
					<div class="detail">
						<p class="profile-name">
							<a href="{% url 'profile' %}" class="profile-link">
								{{ name }}
								<i class="bi bi-pencil profile-edit-icon" aria-hidden="true"></i>
							</a>
						</p>
						<p>{{ rollno }}</p>
						<p>{{ dept }} - {{ section }}</p>
					</div>
				</div>
				<div class="leetcode">
					<h5>Leetcode Profile</h5>
					<div class="leetcode-problems">
						<div>Easy: <span></span></div>
						<div>Medium: <span></span></div>
						<div>Hard: <span></span></div>
					</div>
					<div class="animator">
						<svg
							version="1.1"
							id="L5"
							xmlns="http://www.w3.org/2000/svg"
							xmlns:xlink="http://www.w3.org/1999/xlink"
							x="0px"
							y="0px"
							viewBox="0 0 100 100"
							enable-background="new 0 0 0 0"
							xml:space="preserve"
						>
							<circle
								fill="#fff"
								stroke="none"
								cx="6"
								cy="50"
								r="6"
							>
								<animateTransform
									attributeName="transform"
									dur="1s"
									type="translate"
									values="0 15 ; 0 -15; 0 15"
									repeatCount="indefinite"
									begin="0.1"
								/>
							</circle>
							<circle
								fill="#fff"
								stroke="none"
								cx="30"
								cy="50"
								r="6"
							>
								<animateTransform
									attributeName="transform"
									dur="1s"
									type="translate"
									values="0 10 ; 0 -10; 0 10"
									repeatCount="indefinite"
									begin="0.2"
								/>
							</circle>
							<circle
								fill="#fff"
								stroke="none"
								cx="54"
								cy="50"
								r="6"
							>
								<animateTransform
									attributeName="transform"
									dur="1s"
									type="translate"
									values="0 5 ; 0 -5; 0 5"
									repeatCount="indefinite"
									begin="0.3"
								/>
							</circle>
						</svg>
					</div>
				</div>
			</div>
			<div class="grid">
				<div class="section">
					<h2 id="project">Projects</h2>
					<hr />
					<ul class="multiple" id="projects">
						<!-- Example project list items -->
						{% comment %} {% for certi in projects %}
						<li>
							<h5 class="item-title">{{ certi.title }}</h5>
							<p>Desripton: {{ certi.description }}</p>
							<p>
								<a
									href="{{ certi.github_link }}"
									target="_blank"
									><i class="bi bi-github"></i>
								</a>
							</p>
							<div class="buttons">
								<button class="edit">
									<i class="bi bi-pencil"></i>
								</button>
								<button class="delete">
									<i class="bi bi-x"></i>
								</button>
							</div>
						</li>
						<hr />
						{% endfor %} {% endcomment %}
						<!-- More list items -->
					</ul>
					<button
						data-category="projects"
						onclick="new_item(this);"
						title="Add a new project"
						aria-label="Add new project to your portfolio"
					>
						<i class="bi bi-plus" aria-hidden="true"></i>
						Project
					</button>
				</div>
				<div class="section">
					<h2 id="languages">Foreign Languages</h2>
					<hr />
					<ul class="multiple" id="foreign_languages">
						<!-- Example language list items -->
						{% comment %} {% for certi in Foreign_languages %}
						<li>
							<h5>
								<a
									href="{{ certi.course_link }}"
									target="_blank"
									>{{ certi.title }}</a
								>
							</h5>
							<p>Provider : {{ certi.source }}</p>
							<p>Uploded On: {{ certi.uploaded_at }}</p>
							<div class="buttons">
								<button class="edit">
									<i class="bi bi-pencil"></i>
								</button>
								<button class="delete">
									<i class="bi bi-x"></i>
								</button>
							</div>
						</li>
						<hr />
						{% endfor %} {% endcomment %}
						<!-- More list items -->
					</ul>
					<button
						data-category="languages"
						onclick="new_item(this);"
						title="Add a new foreign language"
						aria-label="Add foreign language certification to your profile"
					>
						<i class="bi bi-plus" aria-hidden="true"></i>
						Language
					</button>
				</div>
				<div class="section">
					<h2 id="technical">Technical Certifications</h2>
					<hr />
					<ul class="multiple" id="technical_certificates">
						{% comment %} {% for certi in Technical %}
						<li>
							<h5>
								<a
									href="{{ certi.course_link }}"
									target="_blank"
									>{{ certi.title }}</a
								>
							</h5>
							<p>Provider : {{ certi.source }}</p>
							<p>Uploded On: {{ certi.uploaded_at }}</p>
							<div class="buttons">
								<button class="edit">
									<i class="bi bi-pencil"></i>
								</button>
								<button class="delete">
									<i class="bi bi-x"></i>
								</button>
							</div>
						</li>
						<hr />
						{% endfor %} {% endcomment %}
						<!-- More list items -->
					</ul>
					<button
						data-category="certificates"
						onclick="new_item(this);"
						title="Add a technical certification"
						aria-label="Add technical certification to your profile"
					>
						<i class="bi bi-plus" aria-hidden="true"></i>
						Certification
					</button>
				</div>
			</div>
		</main>
		<div class="form-check-label">
			<button id="FormToggle" title="View Forms" aria-label="Navigate to forms page"><i class="bi bi-document" aria-hidden="true"></i></button>
			<button id="themeToggle" title="Toggle theme" aria-label="Switch between dark and light theme"><i class="bi bi-moon-fill" aria-hidden="true"></i></button>
			<button id="logout" title="Logout" aria-label="Logout from application"><i class="bi bi-box-arrow-right" aria-hidden="true"></i></button>
		</div>

		<script>
					// Django template variables - properly handled
					let projects = [];
					let technicals = [];
					let Foreign_languages = [];
					
					try {
						// Parse Django template variables safely using escapejs filter
						// This prevents JavaScript linting errors while maintaining functionality
						projects = JSON.parse('{{ projects|escapejs }}') || [];
						technicals = JSON.parse('{{ Technical|escapejs }}') || [];
						Foreign_languages = JSON.parse('{{ Foreign_languages|escapejs }}') || [];
					} catch (error) {
						console.error('Error parsing Django template variables:', error);
						projects = [];
						technicals = [];
						Foreign_languages = [];
					}
					
					const projects_ul = document.querySelector('#projects');
					const technical_ul = document.querySelector('#technical_certificates');
					const foreign_languages_ul = document.querySelector('#foreign_languages');
					document.addEventListener("DOMContentLoaded", () => {
						fetch("{% url 'leetcode' leetcode_user %}").then(response => {
							console.log(response);
							if (response.ok) {
								return response.json();
							} else {
								throw new Error("Network response was not ok");
							}
						}).then(data => {
							document.querySelectorAll(".leetcode span")[0].innerHTML = data.easy_count;
							document.querySelectorAll(".leetcode span")[1].innerHTML = data.medium_count;
							document.querySelectorAll(".leetcode span")[2].innerHTML = data.hard_count;


							document.querySelector(".leetcode .animator").style.display = "none";
							document.querySelector(".leetcode .leetcode-problems").style.display = "block"
						}).catch(error => {
							console.error('Error:', error);
						});


						projects.forEach(project => {
							projects_ul.innerHTML += `<li>
										<h5 class="item-title">${project.fields.title}</h5>
										<p>Desripton: ${project.fields.description}</p>
										<p>${project.fields.year_and_sem}</p>
										<p>
											<a href="${project.fields.github_link}" target="_blank"><i class="bi bi-github"></i>
											</a>
										</p>
										<div class="buttons">
											<button class="edit" onclick="return edit(${project.pk}, 'project')" aria-label="Edit project" title="Edit this project">
												<i class="bi bi-pencil" aria-hidden="true"></i>
											</button>
											<button class="delete" onclick="return delete_item(${project.pk}, 'project')" aria-label="Delete project" title="Delete this project">
												<i class="bi bi-x" aria-hidden="true"></i>
											</button>
										</div>
									</li>
									<hr />`
						});
						technicals.forEach(technical => {
							technical_ul.innerHTML += `<li>
						                      <h5>
						                          <a href="${technical.fields.course_link}" target="_blank">${technical.fields.title}</a>
						                      </h5>
						                      <p>Provider : ${technical.fields.source}</p>
						                      <p>${technical.fields.year_and_sem}</p>
						                      <div class="buttons">
						                          <button class="edit" onclick="return edit(${technical.pk}, 'technical')" aria-label="Edit technical skill" title="Edit this technical skill">
						                              <i class="bi bi-pencil" aria-hidden="true"></i>
						                          </button>
						                          <button class="delete" onclick="return delete_item(${technical.pk}, 'technical')" aria-label="Delete technical skill" title="Delete this technical skill">
						                              <i class="bi bi-x" aria-hidden="true"></i>
						                          </button>
						                      </div>
						                  </li>
						                  <hr />`
						});
						Foreign_languages.forEach(language => {
							foreign_languages_ul.innerHTML += `<li>
										<h5>
											<a href="${language.fields.course_link}" target="_blank">${language.fields.title}</a>
										</h5>
										<p>Provider : ${language.fields.source}</p>
										<p>${language.fields.year_and_sem}</p>
										<div class="buttons">
											<button class="edit" onclick="return edit(${language.pk}, 'language')" aria-label="Edit language certification" title="Edit this language certification">
												<i class="bi bi-pencil" aria-hidden="true"></i>
											</button>
											<button class="delete" onclick="return delete_item(${language.pk}, 'language')" aria-label="Delete language certification" title="Delete this language certification">
												<i class="bi bi-x" aria-hidden="true"></i>
											</button>
										</div>
									</li>
									<hr />`
						});
					});

					const toggleSwitch = document.getElementById("themeToggle");
					const icon = document.querySelector("#themeToggle i");
					const body = document.body;
					const allElements = document.querySelectorAll("*"); // Select all elements
					console.log(allElements);
					const blur = document.querySelector(".blur");
					const projectform = blur.children[0];
					toggleSwitch.addEventListener("click", () => {
						// Toggle the light theme class on the body
						const formAll = document.querySelectorAll(
							"input, select, textarea, option, p, button"
						);
						body.classList.toggle("light-theme");

						// Add or remove the light theme class from all elements
						allElements.forEach((element) => {
							element.classList.toggle(
								"light-theme",
								body.classList.contains("light-theme")
							);
						});

						formAll.forEach((element) => {
							element.classList.toggle(
								"light-theme",
								body.classList.contains("light-theme")
							);
						});
						icon.classList.toggle("bi-moon-fill");
						icon.classList.toggle("bi-brightness-high-fill");
					});

					function remove_form() {
						blur.style.animationDirection = "reverse";
						blur.classList.add("blur-animation");
						projectform.style.animationDirection = "reverse";
						projectform.classList.add("scale-animation");
						setTimeout(() => {
							blur.classList.remove("blur-animation");
							projectform.classList.remove("scale-animation");
							blur.style.display = "none";
						}, 300);
					}

					function new_item(element) {
						category = element.dataset.category;
						blur.style.animationDirection = "normal";
						blur.style.display = "flex";
						blur.classList.add("blur-animation");
						if (category === "projects") {
							projectform.action = "{% url 'create_project' %}";
							projectform.innerHTML = `
			            <h2>Add a Project</h2>
			            <hr>
			            {% csrf_token %}
			            <label for="project-name">Project Name <span class="required">*</span></label>
			            <input type="text" name="project-name" id="project-name" required aria-describedby="project-name-help" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">
			            <small id="project-name-help" class="form-text text-muted">Enter a descriptive name for your project</small>

			            <label for="description">Description <span class="required">*</span></label>
			            <textarea name="description" id="description" required aria-describedby="description-help" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" cols="30" rows="5"></textarea>
			            <small id="description-help" class="form-text text-muted">Provide a detailed description of your project</small>

			            <label for="year-and-sem">Year and Semester</label>
			            <select name="year-and-sem" id="year-and-sem" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">
			                <option value="I-I">I-I</option>
			                <option value="I-II">I-II</option>
			                <option value="II-I">II-I</option>
			                <option value="II-II">II-II</option>
			                <option value="III-I">III-I</option>
			                <option value="III-II">III-II</option>
			                <option value="IV-I">IV-I</option>
			                <option value="IV-II">IV-II</option>
			            </select>

			            <label for="contributors">Contributors</label>
			<input type="text" id="contributors-search" placeholder="Search and select contributors..." class="${body.classList.contains("light-theme") ? "light-theme" : ""}">
			<div id="contributors-list" class="dropdown-list"></div>
			<input type="hidden" name="contributors" id="selected-contributors">
			<div id="selected-contributors-container"></div>

			            <label for="technologies-search">Technologies</label>
			<input type="text" id="technologies-search" placeholder="Search or type new technologies (comma or Enter to add)..." class="${body.classList.contains("light-theme") ? "light-theme" : ""}">
			<div id="technologies-list" class="dropdown-list"></div>
			<input type="hidden" name="technologies" id="selected-technologies">
			<div id="selected-technologies-container"></div>


			            <label for="status">Status</label>
			            <select name="status" id="status" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">
			                <option value="Initialized">Initialized</option>
			                <option value="In_progress">In Progress</option>
			                <option value="Completed">Completed</option>
			            </select>

			            <label for="github">GitHub Link</label>
			            <input type="url" name="github" id="github" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" placeholder="https://github.com/username/repo">>

			            <input type="submit" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" value="Create">
			            <button type="button" class="close-form-btn ${body.classList.contains("light-theme") ? "light-theme" : ""}" onclick="return remove_form()">
			                <i class="bi bi-x ${body.classList.contains("light-theme") ? "light-theme" : ""}"></i>
			            </button>
			        `;

						} else if (category === "languages") {
							projectform.action = "{% url 'add_certification' %}";
							projectform.innerHTML = `<h2>Add a Language</h2>
							           <hr>
							            {% csrf_token %}
						                      <input type="hidden" name="type" value="Foreign Language">
						                      <label for="course-name">Language</label>
						                      <input type="text" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="course-name" id="course-name">
						                      <label for="provider">Provider</label>
							           <input type="text" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="provider" id="provider">
									<label for="year-and-sem">Year and Semester</label>
									   <select name="year-and-sem" id="year-and-sem" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">
										   <option value="I-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">I-I</option>
										   <option value="I-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">I-II</option>
										   <option value="II-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">II-I</option>
										   <option value="II-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">II-II</option>
										   <option value="III-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">III-I</option>
										   <option value="III-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">III-II</option>
										   <option value="IV-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">IV-I</option>
										   <option value="IV-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">IV-II</option>
									   </select>
							           <label for="status">Status</label>
							           <select name="status" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" id="status">
							               <option value="Completed" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">Completed</option>
							               <option value="Pending" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">Pending</option>
							           </select>
							           <label for='course-link'>Course Link</label>
							           <input type="text" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="course-link" id="course-link">
							           <input type="submit" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" value="Create">
							           <button class="close-form-btn" type="button" onclick="return remove_form()"><i class="bi bi-x ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}"></i></button>`;
						} else if (category === "certificates") {
							projectform.action = "{% url 'add_certification' %}";
							projectform.innerHTML = `<h2>Add a Certificate</h2>
						                  <hr>
						                  {% csrf_token %}
						                  <input type="hidden" name="type" value="Technical">
							           <label for="course-name">Course Name</label>
							           <input type="text" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="course-name" id="course-name">
							           <label for="provider">Provider</label>
							           <input type="text" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="provider" id="provider">
									<label for="year-and-sem">Year and Semester</label>
									   <select name="year-and-sem" id="year-and-sem" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">
										   <option value="I-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">I-I</option>
										   <option value="I-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">I-II</option>
										   <option value="II-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">II-I</option>
										   <option value="II-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">II-II</option>
										   <option value="III-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">III-I</option>
										   <option value="III-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">III-II</option>
										   <option value="IV-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">IV-I</option>
										   <option value="IV-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">IV-II</option>
									   </select>
							           <label for="status">Status</label>
							           <select name="status" id="status" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">
							               <option value="Completed" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">Completed</option>
							               <option value="Pending" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">Pending</option>
							           </select>
							           <label for='course-link'>Course Link</label>
							           <input type="text" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="course-link" id="course-link">
							           <input type="submit" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" value="Create">
							           <button type="button" class="close-form-btn ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" onclick="return remove_form()"><i class="bi bi-x ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}"></i></button>`;
						}
						projectform.style.animationDirection = "normal";
						console.log(projectform);
						projectform.classList.add("scale-animation");
						setTimeout(() => {
							blur.classList.remove("blur-animation");
							projectform.classList.remove("scale-animation");
						}, 300);

						const searchInput = document.getElementById("contributors-search");
			    const resultsContainer = document.getElementById("contributors-list");
			    const selectedContributorsContainer = document.getElementById("selected-contributors-container");
			    const hiddenInput = document.getElementById("selected-contributors");
			    let selectedContributors = [];  // Store selected contributor IDs

			    searchInput.addEventListener("input", function () {
			        const query = searchInput.value.trim();
			        if (query.length < 2) return;

			        fetch(`/search_students/?term=${query}`)
			            .then(response => response.json())
			            .then(data => {
			                resultsContainer.innerHTML = "";
			                data.forEach(student => {
			                    if (!selectedContributors.includes(student.id)) {
			                        const item = document.createElement("div");
			                        item.classList.add("dropdown-item");
			                        item.textContent = student.text;
			                        item.dataset.id = student.id;

			                        item.addEventListener("click", function () {
			                            addContributor(student.id, student.text);
			                            searchInput.value = "";
			                            resultsContainer.innerHTML = "";
			                        });

			                        resultsContainer.appendChild(item);
			                    }
			                });
			            })
			            .catch(error => console.error("Error fetching students:", error));
			    });

			    function addContributor(id, name) {
			    if (!selectedContributors.includes(id)) {
			        selectedContributors.push(id);

			        // Create the span for the selected contributor
			        const span = document.createElement("span");
			        span.classList.add("selected-contributor");
			        span.dataset.id = id;
			        span.textContent = name;

			        // Create the remove button
			        const removeBtn = document.createElement("button");
			        removeBtn.innerHTML = "✖";
			        removeBtn.classList.add("remove-contributor");

			        // Attach event listener to remove the contributor when clicked
			        removeBtn.addEventListener("click", function (event) {
			            event.stopPropagation(); // Prevent accidental clicks on parent elements
			            removeContributor(id);
			        });

			        // Append remove button to the span
			        span.appendChild(removeBtn);

			        // Append span to the container
			        selectedContributorsContainer.appendChild(span);

			        // Update hidden input field
			        updateHiddenInput();
			    }
			}


			    function removeContributor(id) {
			        selectedContributors = selectedContributors.filter(cid => cid !== id);
			        updateHiddenInput();
			        document.querySelectorAll(".selected-contributor").forEach(span => {
			            if (span.dataset.id == id) {
			                span.remove();
			            }
			        });
			    }

			    function updateHiddenInput() {
			        hiddenInput.value = selectedContributors.join(",");
			    }

				const techSearchInput = document.getElementById("technologies-search");
			const techResultsContainer = document.getElementById("technologies-list");
			const selectedTechContainer = document.getElementById("selected-technologies-container");
			const techHiddenInput = document.getElementById("selected-technologies");
			let selectedTechnologies = [];  // Store selected technology IDs

			techSearchInput.addEventListener("input", function () {
			    const query = techSearchInput.value.trim();
			    if (query.length < 2) {
			        techResultsContainer.innerHTML = "";
			        return;
			    }

			    fetch(`/search_technologies/?term=${query}`)  // Ensure this endpoint returns tech options
			        .then(response => response.json())
			        .then(data => {
			            techResultsContainer.innerHTML = "";
			            
			            // Show existing technologies
			            data.forEach(tech => {
			                if (!selectedTechnologies.includes(tech.id)) {
			                    const item = document.createElement("div");
			                    item.classList.add("dropdown-item");
			                    item.textContent = tech.name;
			                    item.dataset.id = tech.id;
			                    item.addEventListener("click", function () {
			                        addTechnology(tech.id, tech.name);
			                        techSearchInput.value = "";
			                        techResultsContainer.innerHTML = "";
			                    });

			                    techResultsContainer.appendChild(item);
			                }
			            });
			            
			            // Always show option to add new technology
			            const addNewItem = document.createElement("div");
			            addNewItem.classList.add("dropdown-item", "add-new-tech");
			            addNewItem.innerHTML = `<i class="bi bi-plus"></i> Add "${query}" as new technology`;
			            addNewItem.style.borderTop = data.length > 0 ? "1px solid #ccc" : "none";
			            addNewItem.style.fontStyle = "italic";
			            addNewItem.style.color = "#f39c12";
			            
			            addNewItem.addEventListener("click", function () {
			                createAndAddTechnology(query);
			                techSearchInput.value = "";
			                techResultsContainer.innerHTML = "";
			            });
			            
			            techResultsContainer.appendChild(addNewItem);
			        })
			        .catch(error => console.error("Error fetching technologies:", error));
			});
			
			// Add keydown event listener for Enter key and comma separation
			techSearchInput.addEventListener("keydown", function (event) {
			    if (event.key === "Enter" || event.key === ",") {
			        event.preventDefault();
			        const query = techSearchInput.value.trim();
			        if (query.length >= 2) {
			            // Check if there's an exact match in the dropdown
			            const dropdownItems = techResultsContainer.querySelectorAll('.dropdown-item:not(.add-new-tech)');
			            let exactMatch = false;
			            
			            dropdownItems.forEach(item => {
			                if (item.textContent.toLowerCase() === query.toLowerCase()) {
			                    item.click();
			                    exactMatch = true;
			                }
			            });
			            
			            // If no exact match, create new technology
			            if (!exactMatch) {
			                createAndAddTechnology(query);
			                techSearchInput.value = "";
			                techResultsContainer.innerHTML = "";
			            }
			        }
			    }
			});
			
			// Add support for pasting comma-separated technologies
			techSearchInput.addEventListener("paste", function(event) {
			    setTimeout(() => {
			        const value = techSearchInput.value.trim();
			        if (value.includes(',')) {
			            event.preventDefault();
			            const technologies = value.split(',').map(tech => tech.trim()).filter(tech => tech.length >= 2);
			            techSearchInput.value = "";
			            techResultsContainer.innerHTML = "";
			            
			            // Add each technology
			            technologies.forEach((tech, index) => {
			                setTimeout(() => {
			                    createAndAddTechnology(tech);
			                }, index * 100); // Small delay between each creation to avoid overwhelming the server
			            });
			        }
			    }, 10);
			});
			
			// Close dropdown when clicking outside
			document.addEventListener('click', function(event) {
			    if (!techSearchInput.contains(event.target) && !techResultsContainer.contains(event.target)) {
			        techResultsContainer.innerHTML = "";
			    }
			});
			
			function createAndAddTechnology(name) {
			    const trimmedName = name.trim();
			    if (!trimmedName) return;
			    
			    // Check if technology already exists in selected list by name (case-insensitive)
			    const existingTechSpan = Array.from(selectedTechContainer.children).find(span => 
			        span.textContent.replace('✖', '').trim().toLowerCase() === trimmedName.toLowerCase()
			    );
			    
			    if (existingTechSpan) {
			        alert('This technology is already added!');
			        return;
			    }
			    
			    // Show loading state
			    techSearchInput.disabled = true;
			    techSearchInput.placeholder = 'Creating technology...';
			    
			    // Create technology in the database
			    fetch('/create_technology/', {
			        method: 'POST',
			        headers: {
			            'Content-Type': 'application/json',
			            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
			        },
			        body: JSON.stringify({ name: trimmedName })
			    })
			    .then(response => response.json())
			    .then(data => {
			        if (data.id) {
			            addTechnology(data.id, data.name);
			            if (data.message) {
			                console.log(data.message);
			            }
			        } else if (data.error) {
			            alert('Error creating technology: ' + data.error);
			        }
			    })
			    .catch(error => {
			        console.error('Error creating technology:', error);
			        alert('Error creating technology. Please try again.');
			    })
			    .finally(() => {
			        // Reset loading state
			        techSearchInput.disabled = false;
			        techSearchInput.placeholder = 'Search or type new technologies (comma or Enter to add)...';
			    });
			}

			function addTechnology(id, name) {
			    if (!selectedTechnologies.includes(id)) {
			        selectedTechnologies.push(id);

			        const span = document.createElement("span");
			        span.classList.add("selected-technology");
			        span.dataset.id = id;
			        span.textContent = name;

			        const removeBtn = document.createElement("button");
			        removeBtn.innerHTML = "✖";
			        removeBtn.classList.add("remove-technology");

			        removeBtn.addEventListener("click", function (event) {
			            event.stopPropagation();
			            removeTechnology(id);
			        });

			        span.appendChild(removeBtn);
			        selectedTechContainer.appendChild(span);
			        updateTechHiddenInput();
			    }
			}

			function removeTechnology(id) {
			    selectedTechnologies = selectedTechnologies.filter(tid => tid !== id);
			    updateTechHiddenInput();
			    document.querySelectorAll(".selected-technology").forEach(span => {
			        if (span.dataset.id == id) {
			            span.remove();
			        }
			    });
			}

			function updateTechHiddenInput() {
			    techHiddenInput.value = selectedTechnologies.join(",");
			}

			}

					function edit(id, type) {
						blur.style.animationDirection = "normal";
						blur.style.display = "flex";
						blur.classList.add("blur-animation");
						if (type === "project") {
							projectform.action = "{% url 'edit_project' %}";
							var project = projects.filter(project => project.pk == id)[0];
							console.log(project.fields)
							projectform.innerHTML = `<h2>Edit</h2>
							           <hr>
							            {% csrf_token %}
										<input type="hidden" name="id" value="${id}">
							           <label for="project-name">Project Name</label>
							           <input type="text" value=${project.fields.title} name="project-name" id="project-name" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">
							           <label for="description">Description</label>
							           <textarea name="description" id="description" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" cols="30" rows="5">${project.fields.description}</textarea>
										<label for="year-and-sem">Year and Semester</label>
									   <select name="year-and-sem" id="year-and-sem" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">
										   <option value="I-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${project.fields.year_and_sem == "I-I" ? "selected" : ""}>I-I</option>
										   <option value="I-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${project.fields.year_and_sem == "I-II" ? "selected" : ""}>I-II</option>
										   <option value="II-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}"  ${project.fields.year_and_sem == "II-I" ? "selected" : ""}>II-I</option>
										   <option value="II-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}"  ${project.fields.year_and_sem == "II-II" ? "selected" : ""}>II-II</option>
										   <option value="III-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${project.fields.year_and_sem == "III-I" ? "selected" : ""}>III-I</option>
										   <option value="III-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${project.fields.year_and_sem == "III-II" ? "selected" : ""}>III-II</option>
										   <option value="IV-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${project.fields.year_and_sem == "IV-I" ? "selected" : ""}>IV-I</option>
										   <option value="IV-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${project.fields.year_and_sem == "IV-II" ? "selected" : ""}>IV-II</option>
									   </select>
									   <label for="status">Status</label>
							           <select name="status" id="status" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">
							               <option value="Completed" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">Completed</option>
							               <option value="Initialized" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">Initialized</option>
							           </select>
							           <label for='github'>Github Link</label>
							           <input type="url" value="${project.fields.github_link}" name="github" id="github" placeholder="https://github.com/username/repo" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">
							           <input type="submit" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" value="Update">
							           <button type="button" class="close-form-btn ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" onclick="return remove_form()"><i class="bi bi-x ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}"></i></button>`;
						}
						else if (type === "language") {
							projectform.action = "{% url 'edit_certification' %}";
							console.log(id);
							var language = Foreign_languages.filter(lan => lan.pk == id)[0];
							projectform.innerHTML = `<h2>Edit</h2>
							           <hr>
							            {% csrf_token %}
										<input type="hidden" name="id" value="${id}">
						                      <label for="course-name">Language</label>
						                      <input type="text" value="${language.fields.title}" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="course-name" id="course-name">
						                      <label for="provider">Provider</label>
							           <input type="text" value="${language.fields.source}" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="provider" id="provider">
									<label for="year-and-sem">Year and Semester</label>
						   <select name="year-and-sem" id="year-and-sem" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">
										   <option value="I-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${language.fields.year_and_sem == "I-I" ? "selected" : ""}>I-I</option>
										   <option value="I-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${language.fields.year_and_sem == "I-II" ? "selected" : ""}>I-II</option>
										   <option value="II-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}"  ${language.fields.year_and_sem == "II-I" ? "selected" : ""}>II-I</option>
										   <option value="II-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}"  ${language.fields.year_and_sem == "II-II" ? "selected" : ""}>II-II</option>
										   <option value="III-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${language.fields.year_and_sem == "III-I" ? "selected" : ""}>III-I</option>
										   <option value="III-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${language.fields.year_and_sem == "III-II" ? "selected" : ""}>III-II</option>
										   <option value="IV-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${language.fields.year_and_sem == "IV-I" ? "selected" : ""}>IV-I</option>
										   <option value="IV-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${language.fields.year_and_sem == "IV-II" ? "selected" : ""}>IV-II</option>
									   </select>
							           <label for="status">Status</label>
							           <select name="status" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" id="status">
							               <option value="Completed" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">Completed</option>
							               <option value="Pending" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">Pending</option>
							           </select>
							           <label for='course-link'>Course Link</label>
							           <input type="text" value="${language.fields.course_link}" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="course-link" id="course-link">
							           <input type="submit" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" value="Update">
							           <button class="close-form-btn" type="button" onclick="return remove_form()"><i class="bi bi-x ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}"></i></button>`;
						}
						else if (type === "technical") {
							projectform.action = "{% url 'edit_certification' %}";
							var technical = technicals.filter(skill => skill.pk == id)[0];
							projectform.innerHTML = `<h2>Edit</h2>
						                  <hr>
						                  {% csrf_token %}
										<input type="hidden" name="id" value="${id}">
							           <label for="course-name">Course Name</label>
							           <input type="text" value="${technical.fields.title}" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="course-name" id="course-name">
							           <label for="provider">Provider</label>
							           <input type="text" value="${technical.fields.source}" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="provider" id="provider">
									<label for="year-and-sem">Year and Semester</label>
									   <select name="year-and-sem" id="year-and-sem" class="${body.classList.contains("light-theme") ? "light-theme" : ""}">
										   <option value="I-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${technical.fields.year_and_sem == "I-I" ? "selected" : ""}>I-I</option>
										   <option value="I-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${technical.fields.year_and_sem == "I-II" ? "selected" : ""}>I-II</option>
										   <option value="II-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}"  ${technical.fields.year_and_sem == "II-I" ? "selected" : ""}>II-I</option>
										   <option value="II-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}"  ${technical.fields.year_and_sem == "II-II" ? "selected" : ""}>II-II</option>
										   <option value="III-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${technical.fields.year_and_sem == "III-I" ? "selected" : ""}>III-I</option>
										   <option value="III-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${technical.fields.year_and_sem == "III-II" ? "selected" : ""}>III-II</option>
										   <option value="IV-I" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${technical.fields.year_and_sem == "IV-I" ? "selected" : ""}>IV-I</option>
										   <option value="IV-II" class="${body.classList.contains("light-theme") ? "light-theme" : ""}" ${technical.fields.year_and_sem == "IV-II" ? "selected" : ""}>IV-II</option>
									   </select>
							           <label for="status">Status</label>
							           <select name="status" id="status" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">
							               <option value="Completed" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">Completed</option>
							               <option value="Pending" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}">Pending</option>
							           </select>
							           <label for='course-link'>Course Link</label>
							           <input type="text" value="${technical.fields.course_link}" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" name="course-link" id="course-link">
							           <input type="submit" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" value="Update">
							           <button type="button" class="close-form-btn ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" onclick="return remove_form()"><i class="bi bi-x ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}"></i></button>`
						}
						projectform.style.animationDirection = "normal";
						console.log(projectform);
						projectform.classList.add("scale-animation");
						setTimeout(() => {
							blur.classList.remove("blur-animation");
							projectform.classList.remove("scale-animation");
						}, 300);
					}

					function delete_item(id, type) {
						console.log("Delete")
						blur.style.animationDirection = "normal";
						blur.style.display = "flex";
						blur.classList.add("blur-animation");
						projectform.method = "GET";
						projectform.action = `delete_certification/${id}`;
						if (type == "project") {
							projectform.action = `delete_project/${id}`;
							projectform.innerHTML = `<p>Do you want to delete this project?</p>
								<input type="submit" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" value="Delete">
									<input type="button" value="No" onclick="return remove_form()">
							           <button type="button" class="close-form-btn ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" onclick="return remove_form()"><i class="bi bi-x ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}"></i></button>`
						}
						else if (type == "language") {
							projectform.innerHTML = `<p>Do you want to delete this Language?</p>
								<input type="submit" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" value="Delete">
									<input type="button" value="No" onclick="return remove_form()">
										<button type="button" class="close-form-btn ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" onclick="return remove_form()"><i class="bi bi-x ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}"></i></button>`
						}
						else if (type == "technical") {
							projectform.innerHTML = `<p>Do you want to delete this Certificate?</p>
								<input type="submit" class="${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" value="Delete">
									<input type="button" value="No" onclick="return remove_form()">
										<button type="button" class="close-form-btn ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}" onclick="return remove_form()"><i class="bi bi-x ${body.classList.contains("light-theme")
									? "light-theme"
									: ""
								}"></i></button>`
						}
						projectform.style.animationDirection = "normal";
						console.log(projectform);
						projectform.classList.add("scale-animation");
						setTimeout(() => {
							blur.classList.remove("blur-animation");
							projectform.classList.remove("scale-animation");
						}, 300);
					}
					document.querySelector('#logout').addEventListener('click', () => {
						fetch("{% url 'logout' %}", {
							method: 'GET',
							headers: {
								'Content-Type': 'application/json',
							},
						})
							.then((response) => {
								if (response.ok) {
									window.location.href = "{% url 'login' %}";
								} else {
									throw new Error('Network response was not ok');
								}
							})
							.catch((error) => {
								console.error('Error:', error);
							});
					});
					document.querySelector('#FormToggle').addEventListener('click', () => {
						fetch("{% url 'fillout' %}", {
							method: 'GET',
							headers: {
								'Content-Type': 'application/json',
							},
						})
							.then((response) => {
								if (response.ok) {
									window.location.href = "{% url 'fillout' %}";
								} else {
									throw new Error('Network response was not ok');
								}
							})
							.catch((error) => {
								console.error('Error:', error);
							});
					});
		</script>
	</body>
</html>
